<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Gestor de Sprint</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
  h1 { text-align: center; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  th { background: #eee; }
  .sprint-info { margin-top: 10px; }
  .date-badge { display: inline-block; background: #2176ae; color: #fff; padding: 3px 8px; border-radius: 4px; font-size: 0.9em; }
  #importFile { margin-top: 10px; }
</style>
</head>
<body>
<h1>Gestor de Sprint</h1>

<div class="sprint-info">
  <select id="sprintSelect"></select>
  <div id="dateBadge" class="date-badge"></div>
</div>

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Título</th>
      <th>Pontos</th>
      <th>Responsável</th>
      <th>Concluído</th>
    </tr>
  </thead>
  <tbody id="taskTableBody">
    <!-- tarefas aqui -->
  </tbody>
</table>

<!-- Input para importar backup (se necessário) -->
<input type="file" id="importFile" />

<script>
  // Dados de sprint manualmente inseridos, crie seu backup aqui  
  const data = {
    sprints: [
      {
        "name": "Sprint 1",
        "start": "2025-09-29",
        "end": "2025-10-13",
        "tasks": [
          { "id": "1", "title": "Configurar ambiente", "points": 3, "assignee": "Caio", "status": "notdone" },
          { "id": "2", "title": "Criar página inicial", "points": 5, "assignee": "Aline", "status": "done" }
        ],
        "epics": [/* se houver */],
        "createdAt": 1759182567548,
        "id": "oWc7Iwk6s4pmoVMLEtOR"
      },
      {
        "name": "Sprint 2",
        "start": "2025-10-13",
        "end": "2025-10-26",
        "tasks": [
          { "id": "3", "title": "Implementar login", "points": 8, "assignee": "João", "status": "notdone" },
          { "id": "4", "title": "Criar dashboard", "points": 13, "assignee": "Maria", "status": "notdone" }
        ],
        "epics": [/* epics da sprint 2 */],
        "createdAt": 1759182567548,
        "id": "FtRFM9vWIKFMy7ujKU2r"
      }
    ],
    "selected": 0
  };

  // Para evitar erro do try sem catch, garantimos que nunca haverá try sem tratamento.  
  // A seguir, inicializamos a aplicação:
  const app = {
    state: {
      sprints: data.sprints,
      selected: data.selected
    },
    save() {
      // aqui você pode colocar código para salvar em localStorage, se desejar
      localStorage.setItem('sprints', JSON.stringify(this.state.sprints));
    },
    load() {
      // carregamento de backup local, se desejar
      const backup = localStorage.getItem('sprints');
      if (backup) {
        this.state.sprints = JSON.parse(backup);
      }
    },
    init() {
      // monta o select das sprints
      this.renderSprintOptions();
      this.render();
      // evento de troca de sprint
      document.getElementById('sprintSelect').addEventListener('change', e => {
        this.state.selected = parseInt(e.target.value);
        this.render();
      });
      // evento arquivo importação
      document.getElementById('importFile').addEventListener('change', e => {
        const file = e.target.files?.[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          try {
            const jsonData = JSON.parse(reader.result);
            if (jsonData && Array.isArray(jsonData.sprints)) {
              this.state.sprints = jsonData.sprints;
              this.state.selected = 0;
              this.renderSprintOptions();
              this.render();
              alert('Backup importado com sucesso.');
            } else {
              alert('Arquivo inválido.');
            }
          } catch (err) {
            alert('Erro ao ler o arquivo.');
          }
        };
        reader.readAsText(file);
      });
    },
    renderSprintOptions() {
      const select = document.getElementById('sprintSelect');
      select.innerHTML = '';
      this.state.sprints.forEach((sprint, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = sprint.name || `Sprint ${index + 1}`;
        select.appendChild(option);
      });
    },
    render() {
      const sprint = this.state.sprints[this.state.selected];
      if (!sprint) return;
      // exibir datas
      const start = new Date(sprint.start);
      const end = new Date(sprint.end);
      document.getElementById('dateBadge').textContent = 
        `De ${start.toLocaleDateString()} a ${end.toLocaleDateString()}`;
      // preencher tarefas
      const tbody = document.getElementById('taskTableBody');
      tbody.innerHTML = '';
      sprint.tasks.forEach(t => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${t.id}</td>
          <td>${t.title}</td>
          <td>${t.points}</td>
          <td>${t.assignee}</td>
          <td>${t.status === 'done' ? '✔️' : '❌'}</td>
        `;
        tbody.appendChild(tr);
      });
    }
  };
  // inicializa
  app.init();

</script>
</body>
</html>
